{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/villeheikkila/Developer/nextjs-auth/pages/index.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport Link from \"next/link\";\nimport useSWR from \"swr\";\nimport { supabase } from \"../utils/initSupabase\";\nimport { useEffect, useState } from \"react\";\nimport Auth from \"../components/Auth\";\nimport { useUser } from \"../lib/UserContext\";\n\nvar fetcher = function fetcher(url, token) {\n  return fetch(url, {\n    method: \"GET\",\n    headers: new Headers({\n      \"Content-Type\": \"application/json\",\n      token: token\n    }),\n    credentials: \"same-origin\"\n  }).then(function (res) {\n    return res.json();\n  });\n};\n\nvar Index = function Index() {\n  _s();\n\n  var _useUser = useUser(),\n      user = _useUser.user,\n      session = _useUser.session;\n\n  var _useSWR = useSWR(session ? [\"/api/getUser\", session === null || session === void 0 ? void 0 : session.access_token] : null, fetcher),\n      data = _useSWR.data,\n      error = _useSWR.error;\n\n  var _useState = useState(\"sign_in\"),\n      authView = _useState[0],\n      setAuthView = _useState[1];\n\n  useEffect(function () {\n    var _supabase$auth$onAuth = supabase.auth.onAuthStateChange(function (event, session) {\n      if (event === \"PASSWORD_RECOVERY\") setAuthView(\"update_password\");\n      if (event === \"USER_UPDATED\") setTimeout(function () {\n        return setAuthView(\"sign_in\");\n      }, 1000);\n      fetch(\"/api/auth\", {\n        method: \"POST\",\n        headers: new Headers({\n          \"Content-Type\": \"application/json\"\n        }),\n        credentials: \"same-origin\",\n        body: JSON.stringify({\n          event: event,\n          session: session\n        })\n      }).then(function (res) {\n        return res.json();\n      });\n    }),\n        authListener = _supabase$auth$onAuth.data;\n\n    return function () {\n      authListener === null || authListener === void 0 ? void 0 : authListener.unsubscribe();\n    };\n  }, []);\n\n  var View = function View() {\n    if (!user) return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: \"https://app.supabase.io/img/supabase-dark.svg\",\n          width: \"96\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 49,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          children: [\"Supabase Auth \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 54,\n            columnNumber: 29\n          }, _this), \"with NextJS SSR\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 53,\n          columnNumber: 13\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 48,\n        columnNumber: 11\n      }, _this), /*#__PURE__*/_jsxDEV(Auth, {\n        supabaseClient: supabase,\n        authView: authView,\n        setAuthView: setAuthView\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 58,\n        columnNumber: 11\n      }, _this)]\n    }, void 0, true);\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [authView === \"update_password\" && /*#__PURE__*/_jsxDEV(Auth.UpdatePassword, {\n        supabaseClient: supabase\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 11\n      }, _this), user && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"You're signed in\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(\"h5\", {\n          children: [\"Email: \", user.email]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 74,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: function onClick() {\n            return supabase.auth.signOut();\n          },\n          children: \"Log out\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 76,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 13\n        }, _this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            color: \"red\"\n          },\n          children: \"Failed to fetch user!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 23\n        }, _this), data && !error ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              color: \"green\"\n            },\n            children: \"User data retrieved server-side (in API route):\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 81,\n            columnNumber: 17\n          }, _this), /*#__PURE__*/_jsxDEV(\"pre\", {\n            children: JSON.stringify(data, null, 2)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 85,\n            columnNumber: 17\n          }, _this)]\n        }, void 0, true) : /*#__PURE__*/_jsxDEV(\"div\", {\n          children: \"Loading...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 15\n        }, _this), /*#__PURE__*/_jsxDEV(Link, {\n          href: \"/profile\",\n          children: /*#__PURE__*/_jsxDEV(\"a\", {\n            children: \"SSR example with getServerSideProps\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 92,\n            columnNumber: 15\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 13\n        }, _this)]\n      }, void 0, true)]\n    }, void 0, true);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      maxWidth: \"520px\",\n      margin: \"96px auto\"\n    },\n    children: /*#__PURE__*/_jsxDEV(View, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, _this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(Index, \"XvSsyJe7M+a0lbwokTmssiaMHUc=\", false, function () {\n  return [useUser, useSWR];\n});\n\n_c = Index;\nexport default Index;\n\nvar _c;\n\n$RefreshReg$(_c, \"Index\");","map":{"version":3,"sources":["/Users/villeheikkila/Developer/nextjs-auth/pages/index.tsx"],"names":["Link","useSWR","supabase","useEffect","useState","Auth","useUser","fetcher","url","token","fetch","method","headers","Headers","credentials","then","res","json","Index","user","session","access_token","data","error","authView","setAuthView","auth","onAuthStateChange","event","setTimeout","body","JSON","stringify","authListener","unsubscribe","View","email","signOut","color","maxWidth","margin"],"mappings":"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","sourcesContent":["import Link from \"next/link\";\nimport useSWR from \"swr\";\nimport { supabase } from \"../utils/initSupabase\";\nimport { useEffect, useState } from \"react\";\nimport Auth from \"../components/Auth\";\nimport { useUser } from \"../lib/UserContext\";\n\nconst fetcher = (url: string, token: string) =>\n  fetch(url, {\n    method: \"GET\",\n    headers: new Headers({ \"Content-Type\": \"application/json\", token }),\n    credentials: \"same-origin\",\n  }).then((res) => res.json());\n\nconst Index = () => {\n  const { user, session } = useUser();\n  const { data, error } = useSWR(\n    session ? [\"/api/getUser\", session?.access_token] : null,\n    fetcher\n  );\n  const [authView, setAuthView] = useState(\"sign_in\");\n\n  useEffect(() => {\n    const { data: authListener } = supabase.auth.onAuthStateChange(\n      (event, session) => {\n        if (event === \"PASSWORD_RECOVERY\") setAuthView(\"update_password\");\n        if (event === \"USER_UPDATED\")\n          setTimeout(() => setAuthView(\"sign_in\"), 1000);\n\n        fetch(\"/api/auth\", {\n          method: \"POST\",\n          headers: new Headers({ \"Content-Type\": \"application/json\" }),\n          credentials: \"same-origin\",\n          body: JSON.stringify({ event, session }),\n        }).then((res) => res.json());\n      }\n    );\n\n    return () => {\n      authListener?.unsubscribe();\n    };\n  }, []);\n\n  const View = () => {\n    if (!user)\n      return (\n        <>\n          <div>\n            <img\n              src=\"https://app.supabase.io/img/supabase-dark.svg\"\n              width=\"96\"\n            />\n            <h2>\n              Supabase Auth <br />\n              with NextJS SSR\n            </h2>\n          </div>\n          <Auth\n            supabaseClient={supabase}\n            authView={authView}\n            setAuthView={setAuthView}\n          />\n        </>\n      );\n\n    return (\n      <>\n        {authView === \"update_password\" && (\n          <Auth.UpdatePassword supabaseClient={supabase} />\n        )}\n        {user && (\n          <>\n            <h4>You're signed in</h4>\n            <h5>Email: {user.email}</h5>\n\n            <button onClick={() => supabase.auth.signOut()}>Log out</button>\n            <hr />\n            {error && <div style={{ color: \"red\" }}>Failed to fetch user!</div>}\n            {data && !error ? (\n              <>\n                <div style={{ color: \"green\" }}>\n                  User data retrieved server-side (in API route):\n                </div>\n\n                <pre>{JSON.stringify(data, null, 2)}</pre>\n              </>\n            ) : (\n              <div>Loading...</div>\n            )}\n\n            <Link href=\"/profile\">\n              <a>SSR example with getServerSideProps</a>\n            </Link>\n          </>\n        )}\n      </>\n    );\n  };\n\n  return (\n    <div style={{ maxWidth: \"520px\", margin: \"96px auto\" }}>\n      <View />\n    </div>\n  );\n};\n\nexport default Index;\n"]},"metadata":{},"sourceType":"module"}